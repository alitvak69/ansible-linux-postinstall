---
# linux-postinstall modules
# Load modules

- debug:
    msg: "lp_modules_conf [ {{ lp_modules_conf }} ]"
  when: lp_debug|lower == "yes"

- modprobe:
    name: "{{ item.name }}"
    params: "{{ item.params }}"
    state: "{{ item.state | default('present') }}"
  with_items: "{{ lp_modules }}"

- name: Configure {{ lp_modules_conf }} in Debian
  lineinfile: >
    dest="{{ lp_modules_conf }}"
    regexp="^{{ item.name }}"
    line="{{ item.name }} {{ item.params }}"
    backup="yes"
  with_items: "{{ lp_modules }}"
  when:
    - ansible_os_family == "Debian"
    - item.state | default("present") == "present"

- name: Configure {{ lp_modules_conf }} in RedHat
  lineinfile: >
    dest="{{ lp_modules_conf }}"
    regexp="^modprobe {{ item.name }}"
    line="modprobe {{ item.name }} {{ item.params }}"
    backup="yes"
  with_items: "{{ lp_modules }}"
  when:
    - ansible_os_family == "RedHat"
    - item.state | default("present") == "present"

# EOF
...
